# Apache2 Virtual Host Configuration for CCTV System (HTTP Only - For Testing)
# Place this file in: /etc/apache2/sites-available/cctv-http.conf
# Enable with: sudo a2ensite cctv-http.conf && sudo systemctl reload apache2

# HTTP Virtual Host (No SSL - For Testing)
<VirtualHost *:80>
    ServerName cctv.yourdomain.com
    ServerAlias www.cctv.yourdomain.com localhost
    
    # Document root (not used since we're proxying)
    DocumentRoot /var/www/html
    
    # Security Headers (basic)
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options SAMEORIGIN
    Header always set X-XSS-Protection "1; mode=block"
    
    # Reverse Proxy Configuration
    ProxyPreserveHost On
    ProxyRequests Off
    
    # WebSocket Support for Socket.IO (must come BEFORE main proxy)
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/socket\.io/(.*) "ws://127.0.0.1:3000/socket.io/$1" [P,L]
    
    # Proxy Socket.IO requests (must come BEFORE main proxy)
    ProxyPass /socket.io/ http://127.0.0.1:3000/socket.io/
    ProxyPassReverse /socket.io/ http://127.0.0.1:3000/socket.io/
    
    # Proxy all other requests to Node.js application
    ProxyPass / http://127.0.0.1:3000/
    ProxyPassReverse / http://127.0.0.1:3000/
    
    # Logging
    ErrorLog ${APACHE_LOG_DIR}/cctv_error.log
    CustomLog ${APACHE_LOG_DIR}/cctv_access.log combined
    
    # Log level for debugging
    LogLevel info
    
</VirtualHost>

# Required Apache2 modules:
# sudo a2enmod headers  
# sudo a2enmod proxy
# sudo a2enmod proxy_http
# sudo a2enmod proxy_wstunnel
# sudo a2enmod rewrite

# Installation steps:
# 1. Copy this file to /etc/apache2/sites-available/cctv-http.conf
# 2. Replace 'cctv.yourdomain.com' with your actual domain name or use localhost
# 3. Enable required modules: sudo a2enmod headers proxy proxy_http proxy_wstunnel rewrite
# 4. Enable the site: sudo a2ensite cctv-http.conf
# 5. Disable default site if needed: sudo a2dissite 000-default.conf
# 6. Test configuration: sudo apache2ctl configtest
# 7. Reload Apache: sudo systemctl reload apache2